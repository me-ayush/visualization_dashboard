{% load custom_filters %}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>

    <div class="container mt-5">
        <h1 class="mb-4">Dashboard</h1>

        <div class="row mb-4">
            <!-- Filter options -->
            <div class="col-md-3">
                <label for="end-year-filter">End Year:</label>
                <input type="text" class="form-control" id="end-year-filter">
            </div>

            <div class="col-md-3">
                <label for="topics-filter">Topics:</label>
                <select class="form-control" id="topics-filter">
                    <option value="">All</option>
                    {% for data in data_list|unique_topics %}
                    <option value="{{ data.key }}">{{ data.value }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-3">
                <label for="sector-filter">Sector:</label>
                <select class="form-control" id="sector-filter">
                    <option value="">All</option>
                    <!-- Add options dynamically based on available sectors in the data -->
                    {% for sector in sectors %}
                    <option value="{{ sector }}">{{ sector }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Add other filters as needed -->
        </div>

        <!-- Chart container -->
        <div id="chart-container" class="mb-5"></div>

        <script>
            var data = {{ data| safe }};
            var endYearFilter = document.getElementById('end-year-filter');
            var topicsFilter = document.getElementById('topics-filter');
            var sectorFilter = document.getElementById('sector-filter');

            endYearFilter.addEventListener('input', updateChart);
            topicsFilter.addEventListener('change', updateChart);
            sectorFilter.addEventListener('change', updateChart);

            function updateChart() {
                // Get filter values
                var endYear = endYearFilter.value;
                var selectedTopic = topicsFilter.value;
                var selectedSector = sectorFilter.value;

                // Filter data based on selected filters
                var filteredData = data.filter(function (item) {
                    return (endYear === '' || item.end_year === endYear) &&
                        (selectedTopic === '' || item.topic === selectedTopic) &&
                        (selectedSector === '' || item.sector === selectedSector);
                });

                // Update chart using filtered data
                var intensityData = filteredData.map(function (item) {
                    return item.intensity;
                });

                var likelihoodData = filteredData.map(function (item) {
                    return item.likelihood;
                });

                var relevanceData = filteredData.map(function (item) {
                    return item.relevance;
                });

                // Create scatter plots
                var intensityTrace = {
                    x: intensityData,
                    y: likelihoodData,
                    mode: 'markers',
                    type: 'scatter',
                    name: 'Intensity vs Likelihood'
                };

                var relevanceTrace = {
                    x: relevanceData,
                    y: intensityData,
                    mode: 'markers',
                    type: 'scatter',
                    name: 'Relevance vs Intensity'
                };

                var layout = {
                    title: 'Scatter Plots',
                    xaxis: { title: 'Intensity' },
                    yaxis: { title: 'Likelihood' }
                };

                var traces = [intensityTrace, relevanceTrace];

                Plotly.newPlot('chart-container', traces, layout);
            }

            updateChart();
        </script>
    </div>

</body>

</html>